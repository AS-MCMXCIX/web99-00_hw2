<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>login</title>
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
<div class="top-nav">
    <a class="go-home" href="home.html">&lt; بازگشت به خانه</a>
    <img style="position: absolute;top: 50%;right:0;height: 100%;width: 40%;max-width: 300px;transform: translate(0, -40%)"
         src="files/blue_logo_175x75.png"
         alt="None">
</div>
<div class="center above-600px">
    <div style="position: relative">
        <picture>
            <source media="(min-width:1000px)" srcset="files/signup-highQ-light.jpg">
            <source media="(max-width:1000px)" srcset="files/signup-lowQ-light.jpg">
            <img src="files/signup-highQ-light.jpg" alt="sign image" style="width: 67%;height: 50vh;">
        </picture>
        <div style="background-color: rgba(0,0,255, 0.1);text-align:center;color:blueviolet;font-family: Orbitron;font-size: 200%;display:inline-block;position: absolute;left: 33.5%; top: 50%;transform:translate(-50%, -50%)">
            Why SignUp Now When You Can SignUp Later???
        </div>
    </div>
</div>
<div class="supInFormContainer">
    <div class="supInForm">
        <div style="position: absolute;text-align: center;background-color: gray;width: 100%;height: 12%">
            <button id="signIn" onclick="goToSection('signIn')">ورود
            </button>
            <button id="signUp" class="active" onclick="goToSection('signUp')">
                ثبت نام
            </button>
        </div>
        <div id="signupSection" class="field-container">
            <form id="signupForm" onsubmit="return validateSignup()">
                <input class="field" type="email" id="email" name="email" placeholder="ایمیل">
                <input class="field" type="password" id="pass" name="pass" placeholder="رمز عبور">
                <input class="field" type="password" id="pass-repeat" name="pass2" placeholder="تکرار رمز عبور">
                <br>
                <input style="display:inline-block;float: right;" type="checkbox" id="accept-terms" name="terms">
                <label id="accept-terms-text" for="accept-terms">قوانین و شرایط را میپذیرم</label>
                <input id="signUpButton" href="#register" type="submit" value="ثبت نام">
            </form>
            <div class="alert" style="display: none">
                <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                <span id="error-message">متن خطا</span>
            </div>
        </div>
        <div id="signInSection" class="field-container" style="display: none">
            <form id="signInForm" onsubmit="return validateSignIn()">
                <input class="field" type="email" id="sin_email" name="email" placeholder="ایمیل">
                <input class="field" type="password" id="sin_pass" name="pass" placeholder="رمز عبور">
                <br>
                <input id="signInButton" href="#login" type="submit" value="ورود">
            </form>
            <div class="alert" style="display: none">
                <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                <span id="error-message2" style="display: inline; float: right;margin-right: 0.5vw">متن خطا</span>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    let mail_field = document.getElementById('email');
    let sin_mail = document.getElementById('sin_email');
    let sin_pass = document.getElementById('sin_pass');
    let pass_field = document.getElementById('pass');
    let pass2_field = document.getElementById('pass-repeat');
    let accept_terms = document.getElementById('accept-terms');
    let error_message = document.getElementById('error-message');
    let error_message2 = document.getElementById('error-message2');

    let messages = ['please enter a password.', 'please repeat password.', 'please repeat password correctly.',
        'please enter a valid email.', 'Welcome!', 'Wrong Password!', 'No Such User!', 'please accept terms.'];

    let pass_state_messages = [messages[0], messages[1], messages[2]];
    let db_signIn_state_messages = [messages[4], messages[5], messages[6]];

    function validateSignup() {
        error_message.parentElement.style.display = 'flex';
        if (!validateEmail(mail_field.value)) {
            error_message.innerHTML = messages[3];
        } else {
            let res = validatePass(pass_field.value, pass2_field.value);

            if (res !== -1) {
                error_message.innerText = pass_state_messages[res];
            } else if (!accept_terms.checked) {
                error_message.innerHTML = messages[7];
            } else {
                error_message.parentElement.style.display = 'none';
                return true;
            }
        }
        return false;
    }

    function validateSignIn() {
        error_message2.parentElement.style.display = 'flex';
        if (validateEmail(sin_mail.value)) {
            let res = validateSignInBackend(sin_mail.value, sin_pass.value);
            error_message2.innerHTML = db_signIn_state_messages[res];
            if (res === 0) {
                return true;
            }
            return false;
        }
        error_message2.innerHTML = messages[3];
        return false;
    }

    function validateSignInBackend(email, pass) {
        let email_id_map = new Map();
        email_id_map.set('ex@mail.com', 'ex_usr_id');
        let db = new Map;
        db.set('ex_usr_id', ['ex_usr_pass', 'ex@mail.com']); // an example
        if (email_id_map.has(email)) {
            let usr = db.get(email_id_map.get(email));
            if (usr[0] === pass)
                return 0;
            return 1;
        }
        return 2;
    }

    function validateEmail(email) {
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }

    function validatePass(pass, pass2) {
        if (pass === "") {
            return 0;
        } else if (pass2 === "") {
            return 1;
        }
        return pass === pass2 ? -1 : 2;
    }
</script>
<script>
    let activeSection = 'signUp';

    init();

    function init() {
        var url = document.location.href;
        var params = url.split('?')[1].split('&');
        var data = {}, tmp;
        for (var i = 0, l = params.length; i < l; i++) {
            tmp = params[i].split('=');
            data[tmp[0]] = tmp[1];
        }
        goToSection(data.state);
    }

    function goToSection(s) {
        let sin = document.getElementById('signIn');
        let sup = document.getElementById('signUp');
        switch (s) {
            case 'signIn':
                setInactiveButton(sup);
                setActiveButton(sin);

                document.getElementById('signInSection').style.display = 'block';
                document.getElementById('signupSection').style.display = 'none';
                break;
            case 'signUp':
                setInactiveButton(sin);
                setActiveButton(sup);
                document.getElementById('signInSection').style.display = 'none';
                document.getElementById('signupSection').style.display = 'block';
                break;
        }
        activeSection = s;
    }

    function setActiveButton(btn) {
        if (btn.id !== activeSection) {
            btn.classList.add("active");
        }
    }

    function setInactiveButton(btn) {
        btn.classList.remove("active");
    }
</script>
</html>